<!DOCTYPE html>
<html>
  <head>
    <title>eCloud</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
      <script src="/javascripts/map.js"></script>
      <script src="/javascripts/parsePaperData.js"></script>
      <script src="/javascripts/visualization.js"></script>
      <script src="/socket.io/socket.io.js"></script>
      <script type="application/javascript" src="bower_components/Processing.js/processing.js"></script>
      <script type="application/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>



  </head>
  <body onload="javascript:loadAll();">
   <div id="map"></div>
  <canvas id="overlay"></canvas>
  </body>
<script type="application/javascript">
    var __vis;
    var __users;
    var __solos;
    var loadAll = function() {
        var _width = $(window).width();
        var _height = $(window).height();
        $("#overlay").width(_width);
        $("#overlay").height(_height);
        $("#map").width(_width);
        $("#map").height(_height);



        generateMap();

        __vis = new visualization();
        __vis.init("overlay");

        //connect to socket.io
        var socket = io();
        socket.emit("registerVisualization");
        socket.on("update", function (msg) {
            console.log(msg);
            Object.keys(msg.users).forEach(function(user){
                convertMapCoordToScreen(msg.users[user]);

            });
            __users = msg.users;
            __solos = msg.solos;
            __vis.update(__users,__solos);

        });




    }

</script>
</html>
